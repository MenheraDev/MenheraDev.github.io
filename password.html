<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>パスワード生成ツール</title>
    <style>
        html {
            height: 100%;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: #f0f2f5;
            color: #333;
            transition: background-color 0.3s, color 0.3s;
            height: 100%;
        }

        @media (prefers-color-scheme: dark) {
            body {
                background-color: #1a1a1a;
                color: #ddd;
            }
        }

        #input-form {
            position: fixed;
            bottom: 20vh;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            width: 90%;
            max-width: 400px;
        }

        #input {
            padding: 12px;
            width: 100%;
            box-sizing: border-box;
            border: 1px solid #ccc;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        #input:focus {
            border-color: #007bff;
            outline: none;
        }

        @media (prefers-color-scheme: dark) {
            #input {
                border-color: #444;
                background-color: #333;
                color: #ddd;
            }
        }

        #generate-btn {
            padding: 12px 24px;
            margin-top: 10px;
            width: 100%;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        #generate-btn:hover {
            background-color: #0056b3;
        }

        #results {
            position: absolute;
            top: 10px;
            left: 0;
            right: 0;
            margin: 0 auto;
            max-width: 400px;
            max-height: 45vh;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: #888 #f1f1f1;
            padding: 15px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            transition: background-color 0.3s;
        }

        @media (prefers-color-scheme: dark) {
            #results {
                scrollbar-color: #888 #333;
                background-color: #222;
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
            }
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #eee;
            padding: 10px 0;
            min-height: 30px;
            font-size: 15px;
        }

        .result-item:last-child {
            border-bottom: none;
        }

        @media (prefers-color-scheme: dark) {
            .result-item {
                border-bottom: 1px solid #444;
            }
        }

        .result-item button {
            padding: 6px 12px;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .result-item button:hover {
            background-color: #218838;
        }

        #error {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #dc3545;
            text-align: center;
            font-size: 16px;
            max-width: 80%;
        }

        #copy-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #333;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            display: none;
            font-size: 16px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }

        @media (max-width: 600px) {
            #input-form {
                bottom: 15vh;
            }

            #results {
                max-height: 50vh;
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <div id="input-form">
        <input type="text" id="input" placeholder="名前+日付を入力 (例: 20000415 または 0415)">
        <button id="generate-btn">生成</button>
    </div>
    <div id="results"></div>
    <div id="error"></div>
    <div id="copy-message">コピーしました！</div>

    <script>
        const inputField = document.getElementById('input');
        const generateBtn = document.getElementById('generate-btn');
        const resultsDiv = document.getElementById('results');
        const errorDiv = document.getElementById('error');
        const copyMessage = document.getElementById('copy-message');
        const inputForm = document.getElementById('input-form');

        generateBtn.addEventListener('click', generatePasswords);

        // Adjust input form position when keyboard opens using Visual Viewport API
        function updateInputPosition() {
            if ('visualViewport' in window) {
                const vh = window.innerHeight * 0.01;
                const baseBottom = 20 * vh; // Default 20vh
                const keyboardHeight = window.innerHeight - window.visualViewport.height;
                inputForm.style.bottom = (baseBottom + keyboardHeight) + 'px';
            }
        }

        // Initial call
        updateInputPosition();

        // Listen to resize events
        window.visualViewport.addEventListener('resize', updateInputPosition);
        window.visualViewport.addEventListener('scroll', updateInputPosition);
        window.addEventListener('resize', updateInputPosition);

        function isAlphanumeric(str) {
            if (str.length === 0) return false;
            for (let i = 0; i < str.length; i++) {
                const code = str.charCodeAt(i);
                if (!((code >= 48 && code <= 57) || (code >= 65 && code <= 90) || (code >= 97 && code <= 122))) {
                    return false;
                }
            }
            return true;
        }

        function generatePasswords() {
            const input = inputField.value.trim();
            errorDiv.textContent = '';
            resultsDiv.innerHTML = '';

            if (input.length < 4) { // Minimum name length 1 + date 3
                errorDiv.textContent = '正しい名前（英数字）と日付（YYYYMMDDまたはMMDD、3～4桁または7～8桁）を入力してください（例: 20000415 または 0415）';
                return;
            }

            let dateStart = input.length;
            for (let i = input.length - 1; i >= 0; i--) {
                const code = input.charCodeAt(i);
                if (code < 48 || code > 57) { // Not a digit
                    dateStart = i + 1;
                    break;
                }
            }

            if (dateStart === input.length || dateStart === 0) {
                errorDiv.textContent = '正しい名前（英数字）と日付（YYYYMMDDまたはMMDD、3～4桁または7～8桁）を入力してください（例: 20000415 または 0415）';
                return;
            }

            const name = input.substring(0, dateStart);
            const dateStr = input.substring(dateStart);

            if (!isAlphanumeric(name)) {
                errorDiv.textContent = '正しい名前（英数字）と日付（YYYYMMDDまたはMMDD、3～4桁または7～8桁）を入力してください（例: 20000415 または 0415）';
                return;
            }

            const dateLen = dateStr.length;
            if (![3, 4, 7, 8].includes(dateLen)) {
                errorDiv.textContent = '正しい名前（英数字）と日付（YYYYMMDDまたはMMDD、3～4桁または7～8桁）を入力してください（例: 20000415 または 0415）';
                return;
            }

            let yyyy, mm, dd;
            let hasFullDate = false;

            if (dateLen === 3 || dateLen === 4) {
                // Short date: 3 or 4 digits
                let normalizedDate = dateStr;
                if (dateLen === 3) {
                    normalizedDate = '0' + dateStr;
                }
                mm = normalizedDate.substring(0, 2);
                dd = normalizedDate.substring(2, 4);
            } else if (dateLen === 7 || dateLen === 8) {
                // Full date: 7 or 8 digits
                yyyy = dateStr.substring(0, 4);
                let remaining = dateStr.substring(4);

                if (remaining.length === 3) {
                    remaining = '0' + remaining;
                } else if (remaining.length !== 4) {
                    errorDiv.textContent = 'パスワードが生成できませんでした。入力を確認してください。';
                    return;
                }

                mm = remaining.substring(0, 2);
                dd = remaining.substring(2, 4);
                hasFullDate = true;

                // Validate year: 1500 <= yyyy <= 3000
                const yearNum = parseInt(yyyy, 10);
                if (isNaN(yearNum) || yearNum < 1500 || yearNum > 3000 || yyyy.length !== 4) {
                    errorDiv.textContent = '西暦は1500年以上3000年以下で4桁で入力してください（例: 2000）';
                    return;
                }
            } else {
                errorDiv.textContent = 'パスワードが生成できませんでした。入力を確認してください。';
                return;
            }

            // Validate month and day
            const monthNum = parseInt(mm, 10);
            const dayNum = parseInt(dd, 10);
            if (isNaN(monthNum) || monthNum < 1 || monthNum > 12 || mm.length !== 2) {
                errorDiv.textContent = '有効な日付を入力してください（月は01-12、日は01-31）';
                return;
            }
            if (isNaN(dayNum) || dayNum < 1 || dayNum > 31 || dd.length !== 2) {
                errorDiv.textContent = '有効な日付を入力してください（月は01-12、日は01-31）';
                return;
            }

            // Prepare name variations
            const lowerName = name.toLowerCase();
            const titleName = lowerName.charAt(0).toUpperCase() + lowerName.slice(1);

            // Prepare date variations
            const shortDate = mm + dd;
            let shortDateNoZero = mm.replace(/^0+/, '') + dd.replace(/^0+/, '');
            if (shortDateNoZero === '') shortDateNoZero = '0'; // Prevent empty, but unlikely

            const passwords = new Set(); // Use Set to avoid duplicates

            // Add short date variations
            passwords.add(lowerName + shortDate);
            passwords.add(titleName + shortDate);
            passwords.add(shortDate + lowerName);
            passwords.add(shortDate + titleName);
            passwords.add(lowerName + shortDateNoZero);
            passwords.add(titleName + shortDateNoZero);
            passwords.add(shortDateNoZero + lowerName);
            passwords.add(shortDateNoZero + titleName);

            // Add full date if available
            if (hasFullDate) {
                const fullDate = yyyy + mm + dd;
                passwords.add(lowerName + fullDate);
                passwords.add(titleName + fullDate);
                passwords.add(fullDate + lowerName);
                passwords.add(fullDate + titleName);
            }

            // Display results
            if (passwords.size === 0) {
                errorDiv.textContent = 'パスワードが生成できませんでした。入力を確認してください。';
                return;
            }

            passwords.forEach(pw => {
                const item = document.createElement('div');
                item.className = 'result-item';
                const text = document.createElement('span');
                text.textContent = pw;
                const copyBtn = document.createElement('button');
                copyBtn.textContent = 'コピー';
                copyBtn.addEventListener('click', () => copyToClipboard(pw));
                item.appendChild(text);
                item.appendChild(copyBtn);
                resultsDiv.appendChild(item);
            });
        }

        function copyToClipboard(text) {
            if (navigator.clipboard) {
                navigator.clipboard.writeText(text).then(() => showCopyMessage());
            } else {
                // Fallback for older browsers like Firefox
                const textarea = document.createElement('textarea');
                textarea.value = text;
                textarea.style.position = 'fixed';
                textarea.style.opacity = 0;
                document.body.appendChild(textarea);
                textarea.select();
                try {
                    document.execCommand('copy');
                    showCopyMessage();
                } catch (err) {
                    console.error('Fallback copy failed', err);
                }
                document.body.removeChild(textarea);
            }
        }

        function showCopyMessage() {
            copyMessage.style.display = 'block';
            setTimeout(() => {
                copyMessage.style.display = 'none';
            }, 1000);
        }
    </script>
</body>
</html>
